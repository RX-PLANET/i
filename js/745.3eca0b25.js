"use strict";(self["webpackChunki"]=self["webpackChunki"]||[]).push([[745],{3439:function(t,e,a){a.r(e),a.d(e,{default:function(){return P}});var s=a(6252),i=a(3577);const l={class:"p-message-detail"},n={class:"l-dashboard-primary"},o={class:"w-card m-detail"},d={class:"m-op"},c={class:"u-op"},h={class:"u-op"},r={class:"u-page"},u={class:"u-title"},p={class:"u-desc"},m={key:0,class:"u-avatar"},g=["src"],f={class:"u-time"},v=["innerHTML"],b={class:"u-meta"},_={class:"u-meta-key"},k={class:"u-meta-val u-misc"},w={class:"u-meta"},x={class:"u-meta-key"},$=["href"],y={key:1,class:"u-meta-val u-misc"},D={class:"u-meta"},W={class:"u-meta-key"};function z(t,e,a,z,C,M){var B,q;const N=(0,s.up)("page-header"),L=(0,s.up)("messageFilter"),T=(0,s.up)("Back"),A=(0,s.up)("el-icon"),P=(0,s.up)("el-tooltip"),U=(0,s.up)("Delete"),Z=(0,s.up)("ArrowLeft"),F=(0,s.up)("ArrowRight"),H=(0,s.up)("EditPen"),I=(0,s.up)("Link"),R=(0,s.Q2)("loading");return(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",l,[(0,s.Wm)(N),(0,s._)("div",n,[(0,s.Wm)(L,{onUpdate:M.toList},null,8,["onUpdate"]),(0,s._)("div",o,[(0,s._)("div",d,[(0,s._)("div",c,[(0,s.Wm)(P,{class:"u-box-item",effect:"light",content:t.$t("notification.message.toolbar.back"),placement:"top"},{default:(0,s.w5)((()=>[(0,s._)("div",{class:"u-op-icon u-back",onClick:e[0]||(e[0]=(...t)=>M.handleBack&&M.handleBack(...t))},[(0,s.Wm)(A,null,{default:(0,s.w5)((()=>[(0,s.Wm)(T)])),_:1})])])),_:1},8,["content"]),(0,s.Wm)(P,{class:"u-box-item",effect:"light",content:t.$t("notification.message.toolbar.delete"),placement:"top"},{default:(0,s.w5)((()=>[(0,s._)("div",{class:"u-op-icon u-delete",onClick:e[1]||(e[1]=(...t)=>M.handleDelete&&M.handleDelete(...t))},[(0,s.Wm)(A,null,{default:(0,s.w5)((()=>[(0,s.Wm)(U)])),_:1})])])),_:1},8,["content"])]),(0,s._)("div",h,[(0,s._)("span",r,(0,i.zw)(C.index+1)+" - "+(0,i.zw)(C.per>C.total?C.total:C.per)+" / "+(0,i.zw)(C.total),1),(0,s.Wm)(P,{class:"u-box-item",effect:"light",content:t.$t("notification.message.toolbar.previous"),placement:"top"},{default:(0,s.w5)((()=>[(0,s._)("div",{class:(0,i.C_)(["u-op-icon u-page-btn",M.previewDisabled?"is-disabled":""]),onClick:e[2]||(e[2]=(...t)=>M.handlePrevious&&M.handlePrevious(...t))},[(0,s.Wm)(A,null,{default:(0,s.w5)((()=>[(0,s.Wm)(Z)])),_:1})],2)])),_:1},8,["content"]),(0,s.Wm)(P,{class:"u-box-item",effect:"light",content:t.$t("notification.message.toolbar.next"),placement:"top"},{default:(0,s.w5)((()=>[(0,s._)("div",{class:(0,i.C_)(["u-op-icon u-page-btn",M.nextDisabled?"is-disabled":""]),onClick:e[3]||(e[3]=(...t)=>M.handleNext&&M.handleNext(...t))},[(0,s.Wm)(A,null,{default:(0,s.w5)((()=>[(0,s.Wm)(F)])),_:1})],2)])),_:1},8,["content"])])]),(0,s._)("div",{class:(0,i.C_)(["m-content",1===C.detail.status?"is-read":""])},[(0,s._)("div",u,[(0,s._)("span",null,(0,i.zw)(C.detail.title||"-"),1),null!==(B=M.levelMap[C.detail.level])&&void 0!==B&&B.label?((0,s.wg)(),(0,s.iD)("span",{key:0,class:(0,i.C_)(["u-level",`u-level-${C.detail.level}`])},(0,i.zw)(null===(q=M.levelMap[C.detail.level])||void 0===q?void 0:q.label),3)):(0,s.kq)("",!0)]),(0,s._)("div",p,[C.detail.app?((0,s.wg)(),(0,s.iD)("div",m,[(0,s._)("img",{class:"u-img",src:M.getAppIcon(C.detail.app)},null,8,g),(0,s._)("span",null,(0,i.zw)(C.detail.app||"-"),1)])):(0,s.kq)("",!0),(0,s._)("time",f,(0,i.zw)(M.formatDate(C.detail.created_at,"datetime")),1)]),(0,s._)("div",{class:"u-content",innerHTML:C.detail.content},null,8,v),(0,s._)("div",b,[(0,s._)("span",_,(0,i.zw)(t.$t("notification.message.table.remark")),1),(0,s._)("span",k,(0,i.zw)(C.detail.remark||"-"),1),(0,s.Wm)(A,{class:"u-edit",onClick:M.handleRemark},{default:(0,s.w5)((()=>[(0,s.Wm)(H)])),_:1},8,["onClick"])]),(0,s._)("div",w,[(0,s._)("span",x,(0,i.zw)(t.$t("notification.message.meta.link")),1),C.detail.link?((0,s.wg)(),(0,s.iD)("a",{key:0,class:"u-meta-val u-link",href:C.detail.link,target:"_blank"},[(0,s.Wm)(A,null,{default:(0,s.w5)((()=>[(0,s.Wm)(I)])),_:1}),(0,s.Uk)(" "+(0,i.zw)(C.detail.link),1)],8,$)):((0,s.wg)(),(0,s.iD)("span",y,"-"))]),(0,s._)("div",D,[(0,s._)("span",W,(0,i.zw)(t.$t("notification.message.meta.misc")),1),(0,s._)("span",{class:(0,i.C_)(["u-meta-val u-misc",`u-status-${C.detail.status}`])},(0,i.zw)(C.detail.type||"-")+" ✿ "+(0,i.zw)(C.detail.subtype||"-")+" ✿ "+(0,i.zw)(C.detail.resource_type||"-")+" ✿ "+(0,i.zw)(C.detail.resource_id||"-"),3)])],2)])])])),[[R,C.loading]])}var C=a(6467),M=a(6430),B=a(5185),q=a(1259),N=a(9819),L={name:"MessageDetail",components:{pageHeader:M.Z,messageFilter:B.Z},data(){return{loading:!1,page:1,per:10,index:0,total:0,detail:{},ids:[]}},computed:{id(){return~~this.$route.params.id},previewDisabled(){return 1===this.page&&0===this.index},nextDisabled(){return this.total<=(this.page-1)*this.per+this.index+1},levelMap(){return(0,q.$Y)({array:N.g,key:"value"})},statusMap(){return(0,q.$Y)({array:N.s,key:"value"})}},watch:{id(t){t&&this.init()}},mounted(){this.init()},methods:{updateMessageStatus(){const t=this.id+"";(0,C.I2)(t)},init(){const t=this.$route.query;t.page&&(this.page=Number(t.page)),t.per&&(this.per=Number(t.per)),t.total&&(this.total=Number(t.total)),t.index&&(this.index=Number(t.index)),this.loadMessages(),this.loadData()},formatDate:q.p6,toList(t){this.$router.push({name:"dashboard-notification-message",params:t})},handleBack(){const t={page:this.page,per:this.per};this.$router.push({name:"dashboard-notification-message",params:t})},handleDelete(){const t=this.id;t&&this.$confirm(this.$t("notification.message.table.del_message"),this.$t("common.messagebox.title"),{confirmButtonText:this.$t("common.messagebox.confirm"),cancelButtonText:this.$t("common.messagebox.cancel"),type:"warning"}).then((()=>{this.loading=!0,(0,C.Zj)(t).then((()=>{this.$notify({title:this.$t("common.messagebox.success"),type:"success",duration:2e3}),this.handleBack()})).finally((()=>{this.loading=!1}))})).catch((()=>{}))},loadData(){this.loading=!0,(0,C.FC)(this.id).then((t=>{this.detail=t.data.data||{},0===this.detail.status&&this.updateMessageStatus()})).finally((()=>{this.loading=!1}))},async loadMessages(){await(0,C._U)({page:this.page,per:this.per}).then((t=>{const{list:e,total:a}=t.data.data,s=e.map((t=>t.id));this.ids=s,this.total=a}))},handleRemark(){const{id:t,remark:e}=this.detail;this.$prompt(this.$t("notification.message.table.remark_placeholder"),this.$t("common.messagebox.title"),{confirmButtonText:this.$t("common.messagebox.confirm"),cancelButtonText:this.$t("common.messagebox.cancel"),inputValue:e}).then((({value:a})=>{const s={remark:a};a!==e&&(0,C.o6)(t,s).then((()=>{this.$notify({title:this.$t("common.messagebox.success"),type:"success",duration:2e3}),this.detail.remark=a}))})).catch((()=>{}))},handlePrevious(){if(!this.previewDisabled&&(0!==this.index||1!==this.page)&&(0===this.index&&this.page>1&&(this.page=this.page-1,this.loadMessages().then((()=>{const t=this.ids[this.ids.length-1];this.$router.push({path:`/dashboard/notification/message-detail/${t}`,query:{page:this.page,per:this.per,index:this.ids.length-1,total:this.total}})}))),this.index>0)){const t=this.index-1,e=this.ids[t];this.$router.push({path:`/dashboard/notification/message-detail/${e}`,query:{page:this.page,per:this.per,index:t,total:this.total}})}},handleNext(){if(this.nextDisabled)return;const t=this.page===Math.ceil(this.total/this.per),e=this.index>=this.per-1;if(console.log(e,t),(!e||!t)&&(e&&!t&&(this.page=this.page+1,this.loadMessages().then((()=>{const t=this.ids[0];this.$router.push({path:`/dashboard/notification/message-detail/${t}`,query:{page:this.page,per:this.per,index:0,total:this.total}})}))),!e)){const t=this.index+1,e=this.ids[t];this.$router.push({path:`/dashboard/notification/message-detail/${e}`,query:{page:this.page,per:this.per,index:t,total:this.total}})}},getAppIcon(t){return a(7137)(`./${t}.svg`)}}},T=a(3744);const A=(0,T.Z)(L,[["render",z]]);var P=A}}]);
//# sourceMappingURL=745.3eca0b25.js.map