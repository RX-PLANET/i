(self["webpackChunki"]=self["webpackChunki"]||[]).push([[865],{6607:function(e){!function(t,i){e.exports=i()}(0,(function(){"use strict";return function(e,t,i){t.prototype.isBetween=function(e,t,a,s){var n=i(e),o=i(t),l="("===(s=s||"()")[0],r=")"===s[1];return(l?this.isAfter(n,a):!this.isBefore(n,a))&&(r?this.isBefore(o,a):!this.isAfter(o,a))||(l?this.isBefore(n,a):!this.isAfter(n,a))&&(r?this.isAfter(o,a):!this.isBefore(o,a))}}}))},7124:function(e){!function(t,i){e.exports=i()}(0,(function(){"use strict";return function(e,t,i){t.prototype.isToday=function(){var e="YYYY-MM-DD",t=i();return this.format(e)===t.format(e)}}}))},356:function(e){!function(t,i){e.exports=i()}(0,(function(){"use strict";return function(e,t,i){t.prototype.isYesterday=function(){var e="YYYY-MM-DD",t=i().subtract(1,"day");return this.format(e)===t.format(e)}}}))},9542:function(e){!function(t,i){e.exports=i()}(0,(function(){"use strict";var e="day";return function(t,i,a){var s=function(t){return t.add(4-t.isoWeekday(),e)},n=i.prototype;n.isoWeekYear=function(){return s(this).year()},n.isoWeek=function(t){if(!this.$utils().u(t))return this.add(7*(t-this.isoWeek()),e);var i,n,o,l,r=s(this),c=(i=this.isoWeekYear(),n=this.$u,o=(n?a.utc:a)().year(i).startOf("year"),l=4-o.isoWeekday(),o.isoWeekday()>4&&(l+=7),o.add(l,e));return r.diff(c,"week")+1},n.isoWeekday=function(e){return this.$utils().u(e)?this.day()||7:this.day(this.day()%7?e:e-7)};var o=n.startOf;n.startOf=function(e,t){var i=this.$utils(),a=!!i.u(t)||t;return"isoweek"===i.p(e)?a?this.date(this.date()-(this.isoWeekday()-1)).startOf("day"):this.date(this.date()-1-(this.isoWeekday()-1)+7).endOf("day"):o.bind(this)(e,t)}}}))},3338:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return le}});var a=i(6252);const s={class:"p-message"};function n(e,t,i,n,o,l){const r=(0,a.up)("page-header"),c=(0,a.up)("messageBox");return(0,a.wg)(),(0,a.iD)("div",s,[(0,a.Wm)(r),(0,a.Wm)(c,{class:"l-dashboard-primary",initApp:l.initApp},null,8,["initApp"])])}var o=i(3577),l=i(9963);const r={class:"m-message-box"},c={class:"m-message-main w-card"},d={class:"m-table"},u={class:"m-table-header"},h={class:"u-op"},m={class:"u-op-icon"},p={class:"m-table-body"},f={class:"m-table-body__title"},g={class:"u-total"},b={class:"m-table-body__list"},y=["onClick"],k={class:"m-table-body__column u-checkbox"},v={class:"m-table-body__column u-content is-flex"},_={class:"m-table-body__column u-time"},w={class:"m-table-body__column u-op"},D=["href","onClick"];function x(e,t,i,s,n,x){const $=(0,a.up)("messageFilter"),W=(0,a.up)("el-checkbox"),C=(0,a.up)("Refresh"),Y=(0,a.up)("el-icon"),S=(0,a.up)("el-tooltip"),A=(0,a.up)("Message"),L=(0,a.up)("Delete"),M=(0,a.up)("arrow-down"),V=(0,a.up)("el-dropdown-item"),B=(0,a.up)("el-dropdown-menu"),U=(0,a.up)("el-dropdown"),H=(0,a.up)("Search"),O=(0,a.up)("el-input"),R=(0,a.up)("el-button"),T=(0,a.up)("Link"),I=(0,a.up)("el-pagination"),z=(0,a.Q2)("loading");return(0,a.wg)(),(0,a.iD)("div",r,[(0,a.Wm)($,{initApp:i.initApp,onUpdate:x.updateSearch},null,8,["initApp","onUpdate"]),(0,a._)("div",c,[(0,a._)("div",d,[(0,a._)("div",u,[(0,a._)("div",h,[(0,a.Wm)(W,{class:"u-checkbox-all",modelValue:n.checkAll,"onUpdate:modelValue":t[0]||(t[0]=e=>n.checkAll=e),indeterminate:n.isIndeterminate,onChange:x.handleCheckAllChange,disabled:!n.originList.length},null,8,["modelValue","indeterminate","onChange","disabled"]),(0,a.Wm)(S,{class:"u-box-item",effect:"light",content:e.$t("notification.message.toolbar.refresh"),placement:"top"},{default:(0,a.w5)((()=>[(0,a._)("div",{class:"u-op-icon u-refresh",onClick:t[1]||(t[1]=(...e)=>x.loadData&&x.loadData(...e))},[(0,a.Wm)(Y,null,{default:(0,a.w5)((()=>[(0,a.Wm)(C)])),_:1})])])),_:1},8,["content"]),(0,a.Wm)(S,{class:"u-box-item",effect:"light",content:e.$t("notification.message.toolbar.read_config"),placement:"top"},{default:(0,a.w5)((()=>[(0,a._)("div",{class:"u-op-icon u-read",onClick:t[2]||(t[2]=(...e)=>x.handleReadAll&&x.handleReadAll(...e))},[(0,a.Wm)(Y,null,{default:(0,a.w5)((()=>[(0,a.Wm)(A)])),_:1})])])),_:1},8,["content"]),(0,a.Wm)(S,{class:"u-box-item",effect:"light",content:e.$t("notification.message.toolbar.delete"),placement:"top"},{default:(0,a.w5)((()=>[(0,a._)("div",{class:(0,o.C_)(["u-op-icon u-delete",n.multipleSelection.length?"":"is-disabled"]),onClick:t[3]||(t[3]=(...e)=>x.batchDelete&&x.batchDelete(...e))},[(0,a.Wm)(Y,null,{default:(0,a.w5)((()=>[(0,a.Wm)(L)])),_:1})],2)])),_:1},8,["content"]),(0,a.Wm)(U,null,{dropdown:(0,a.w5)((()=>[(0,a.Wm)(B,null,{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.statusList,(e=>((0,a.wg)(),(0,a.j4)(V,{key:e.value,onClick:t=>x.onStatusChange(e.value)},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.label),1)])),_:2},1032,["onClick"])))),128))])),_:1})])),default:(0,a.w5)((()=>[(0,a._)("span",m,[(0,a.Wm)(Y,{class:"el-icon--right"},{default:(0,a.w5)((()=>[(0,a.Wm)(M)])),_:1})])])),_:1})]),(0,a.Wm)(O,{class:"u-search",modelValue:n.searchKey,"onUpdate:modelValue":t[4]||(t[4]=e=>n.searchKey=e),placeholder:e.$t("notification.message.toolbar.search")},{prefix:(0,a.w5)((()=>[(0,a.Wm)(Y,null,{default:(0,a.w5)((()=>[(0,a.Wm)(H)])),_:1})])),_:1},8,["modelValue","placeholder"])]),(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",p,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.tableData,(i=>((0,a.wg)(),(0,a.iD)("div",{class:"m-table-body__item",key:i.id},[(0,a._)("div",f,[(0,a.Uk)((0,o.zw)(i.label)+" (",1),(0,a._)("b",g,(0,o.zw)(i.children.length),1),t[8]||(t[8]=(0,a.Uk)(") "))]),(0,a._)("div",b,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(i.children,(i=>((0,a.wg)(),(0,a.iD)("div",{class:(0,o.C_)(["m-table-body__row",1===i.status?"is-read":""]),key:i.id,onClick:e=>x.toDetail(i)},[(0,a._)("div",k,[(0,a.Wm)(W,{modelValue:i.checked,"onUpdate:modelValue":e=>i.checked=e,onChange:e=>x.checkChange(i),onClick:t[5]||(t[5]=(0,l.iM)((()=>{}),["stop"]))},null,8,["modelValue","onUpdate:modelValue","onChange"])]),(0,a._)("div",v,[(0,a._)("div",{class:(0,o.C_)(["u-icon",`u-icon-${i.level}`])},null,2),(0,a._)("span",null,(0,o.zw)(i.title||"-"),1)]),(0,a._)("div",_,(0,o.zw)(x.formatDate(i.created_at,"datetime")),1),(0,a._)("div",w,[(0,a.Wm)(S,{class:"u-box-item",effect:"light",content:e.$t("notification.message.table.detail"),placement:"top"},{default:(0,a.w5)((()=>[(0,a.Wm)(R,{class:"u-view",circle:"",plain:"",icon:"View",onClick:(0,l.iM)((e=>x.toDetail(i)),["stop"])},null,8,["onClick"])])),_:2},1032,["content"]),i.link?((0,a.wg)(),(0,a.j4)(S,{key:0,class:"u-box-item",effect:"light",content:e.$t("notification.message.table.link"),placement:"top"},{default:(0,a.w5)((()=>[(0,a._)("a",{class:"u-detail el-button is-plain is-circle",href:x.toLink(i),target:"_blank",onClick:(0,l.iM)((e=>x.handleRead(i)),["stop"])},[(0,a.Wm)(Y,null,{default:(0,a.w5)((()=>[(0,a.Wm)(T)])),_:1})],8,D)])),_:2},1032,["content"])):(0,a.kq)("",!0)])],10,y)))),128))])])))),128))])),[[z,n.loading]])]),(0,a.Wm)(I,{class:"m-pagination",currentPage:n.page,"onUpdate:currentPage":t[6]||(t[6]=e=>n.page=e),background:"",pageSize:n.per,"onUpdate:pageSize":t[7]||(t[7]=e=>n.per=e),layout:"prev, pager, next",total:n.total,size:"small","hide-on-single-page":""},null,8,["currentPage","pageSize","total"])])])}var $,W=i(7484),C=i.n(W),Y=i(9542),S=i.n(Y),A=i(7124),L=i.n(A),M=i(356),V=i.n(M),B=i(6607),U=i.n(B),H=i(7412),O=i.n(H),R=i(6486),T=new Uint8Array(16);function I(){if(!$&&($="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),!$))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return $(T)}var z=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function j(e){return"string"===typeof e&&z.test(e)}for(var K=j,Z=[],P=0;P<256;++P)Z.push((P+256).toString(16).substr(1));function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(Z[e[t+0]]+Z[e[t+1]]+Z[e[t+2]]+Z[e[t+3]]+"-"+Z[e[t+4]]+Z[e[t+5]]+"-"+Z[e[t+6]]+Z[e[t+7]]+"-"+Z[e[t+8]]+Z[e[t+9]]+"-"+Z[e[t+10]]+Z[e[t+11]]+Z[e[t+12]]+Z[e[t+13]]+Z[e[t+14]]+Z[e[t+15]]).toLowerCase();if(!K(i))throw TypeError("Stringified UUID is invalid");return i}var q=E;function F(e,t,i){e=e||{};var a=e.random||(e.rng||I)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){i=i||0;for(var s=0;s<16;++s)t[i+s]=a[s];return t}return q(a)}var Q=F,G=i(1259),J=i(9819),N=i(6467),X=i(5185);C().extend(S()),C().extend(L()),C().extend(V()),C().extend(U()),C().extend(O());var ee={name:"message-box",components:{messageFilter:X.Z},props:{initApp:{type:String,default:""}},data(){return{loading:!1,tableData:[],originList:[],search:{},status:"",searchKey:"",page:1,per:10,total:0,checkAll:!1,isIndeterminate:!1,multipleSelection:[],levelList:J.g,statusList:J.s,timeTypes:[{id:Q(),label:this.$t("notification.message.time.today"),value:7},{id:Q(),label:this.$t("notification.message.time.saturday"),value:6},{id:Q(),label:this.$t("notification.message.time.friday"),value:5},{id:Q(),label:this.$t("notification.message.time.thursday"),value:4},{id:Q(),label:this.$t("notification.message.time.wednesday"),value:3},{id:Q(),label:this.$t("notification.message.time.tuesday"),value:2},{id:Q(),label:this.$t("notification.message.time.monday"),value:1},{id:Q(),label:this.$t("notification.message.time.last"),value:-1},{id:Q(),label:this.$t("notification.message.time.earlier"),value:-2}]}},computed:{params(){const e={per:this.per,page:this.page,_search:this.searchKey,status:this.status,...this.search};return e}},watch:{originList:{immediate:!0,deep:!0,handler(){this.tableData=this.arr2Tree(this.originList)}},params:{immediate:!0,handler:function(){this.loadData()}}},methods:{onStatusChange(e){this.status=e},formatDate:G.p6,loadData(){this.loading=!0,(0,N._U)((0,G.HO)(this.params)).then((e=>{this.multipleSelection=[],this.checkAll=!1;const{list:t,total:i}=e.data.data;this.originList=t,this.total=i})).finally((()=>{this.loading=!1}))},checkChange(e){const t=this.originList.findIndex((t=>t.id===e.id));this.originList[t].checked=!!e.checked;const i=this.multipleSelection.findIndex((t=>t.id===e.id));-1!==i?this.multipleSelection.splice(i,1):this.multipleSelection.push(e),this.isIndeterminate=!!(this.multipleSelection.length&&this.multipleSelection.length<this.originList.length)},handleRead(e){if(1===e.status)return;const{id:t,remark:i}=e,a={status:1,remark:i};(0,N.o6)(t,a).then((()=>{this.$notify({title:this.$t("common.messagebox.success"),type:"success",duration:2e3}),this.loadData()}))},handleCheckAllChange(e){this.multipleSelection=e?(0,R.flattenDeep)(this.tableData.map((e=>e.children))):[],this.isIndeterminate=!1,this.originList=this.originList.map((e=>({...e,checked:!!this.multipleSelection.length}))),this.tableData=this.arr2Tree(this.originList)},updateSearch(e){this.page=1,this.search=(0,R.pickBy)(e,(e=>null!==e&&""!==e))},arr2Tree(e,t="created_at"){const i=this.timeTypes,a=[],s=C()(),n={start:C()().startOf("isoWeek").format("YYYY-MM-DD HH:mm:ss"),end:C()().endOf("isoWeek").format("YYYY-MM-DD HH:mm:ss")},o={start:C()().startOf("isoWeek").add(-1,"week").format("YYYY-MM-DD HH:mm:ss"),end:C()().endOf("isoWeek").add(-1,"week").format("YYYY-MM-DD HH:mm:ss")};return e.forEach((e=>{Object.hasOwnProperty.call(e,"checked")||(e.checked=!1);const l=C()(e[t]);let r;if(C()(l).isSameOrBefore(s)&&(C()(l).isToday()?r=i.find((e=>7===e.value)):C()(l).isBetween(n.start,n.end)?(r=i.find((e=>e.value===C()(l).day())),C()(l).isYesterday()&&(r.label="昨天")):r=C()(l).isBetween(o.start,o.end)?i.find((e=>-1===e.value)):i.find((e=>-2===e.value))),r){const t=a.find((e=>e.value===r.value));t?t.children.push(e):a.push({label:r.label,value:r.value,id:r.id,children:[e]})}})),a.sort(((e,t)=>t.value-e.value))},getLevel(e){return this.levelList.find((t=>t.value==e))},resetChecked(){this.isIndeterminate=!1,this.checkAll=!1,this.multipleSelection=[]},handleRemark(e){const{id:t,remark:i}=e;this.$prompt(this.$t("notification.message.table.remark_placeholder"),this.$t("common.messagebox.title"),{confirmButtonText:this.$t("common.messagebox.confirm"),cancelButtonText:this.$t("common.messagebox.cancel"),inputValue:i}).then((({value:i})=>{const a={remark:i};i!==e.remark&&(0,N.o6)(t,a).then((()=>{this.$notify({title:this.$t("common.messagebox.success"),type:"success",duration:2e3});const e=this.originList.findIndex((e=>e.id===t));this.originList[e].remark=i}))})).catch((()=>{}))},batchDelete(){this.multipleSelection.length&&this.handleDelete(this.multipleSelection)},handleDelete(e){let t="";const i=Array.isArray(e);t=i?e.map((e=>e.id)).join():e.id,t&&this.$confirm(this.$t("notification.message.table.del_mul_message"),this.$t("common.messagebox.title"),{confirmButtonText:this.$t("common.messagebox.confirm"),cancelButtonText:this.$t("common.messagebox.cancel"),type:"warning"}).then((()=>{this.loading=!0,(0,N.Zj)(t).then((()=>{this.$notify({title:this.$t("common.messagebox.success"),type:"success",duration:2e3}),this.page=1,this.loadData()})).finally((()=>{this.loading=!1}))})).catch((()=>{}))},loadMessages(){this.loadData()},handleReadAll(){const e=this.search.app||"",t=this.multipleSelection.map((e=>e.id)).join(",")||"",i={};e&&(i.app=e),(0,N.I2)(t,i).then((()=>{this.$notify({title:this.$t("common.messagebox.success"),type:"success",duration:2e3})}))},toLink(e){const{link:t}=e;return t},toDetail({id:e}){const t=this.originList.findIndex((t=>t.id===e));this.$router.push({path:`/dashboard/notification/message-detail/${e}`,query:{page:this.page,per:this.per,total:this.total,index:t}})}}},te=i(3744);const ie=(0,te.Z)(ee,[["render",x]]);var ae=ie,se=i(6430),ne={name:"dashboard-notification-message",components:{messageBox:ae,pageHeader:se.Z},computed:{initApp(){return""}}};const oe=(0,te.Z)(ne,[["render",n]]);var le=oe}}]);
//# sourceMappingURL=865.2f626b56.js.map