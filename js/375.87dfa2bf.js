"use strict";(self["webpackChunki"]=self["webpackChunki"]||[]).push([[375],{6430:function(e,t,a){a.d(t,{Z:function(){return v}});var s=a(6252),l=a(3577),o=a(9963);const i={class:"c-header"},d={class:"c-header_main"},n={class:"c-header-left"},r={key:0,class:"c-header__title"},u={key:1,class:"c-header__desc"},c={class:"c-header-right"},m={class:"c-header__profile"},h={class:"u-name"};function p(e,t,a,p,g,f){var b,w;const _=(0,s.up)("lang-select"),v=(0,s.up)("el-dropdown-item"),$=(0,s.up)("el-dropdown-menu"),k=(0,s.up)("el-dropdown");return(0,s.wg)(),(0,s.iD)("div",i,[(0,s._)("div",d,[(0,s._)("div",n,[null!==(b=f.routeMeta)&&void 0!==b&&b.title?((0,s.wg)(),(0,s.iD)("div",r,(0,l.zw)(f.routeMeta.title),1)):(0,s.kq)("",!0),null!==(w=f.routeMeta)&&void 0!==w&&w.desc?((0,s.wg)(),(0,s.iD)("div",u,(0,l.zw)(f.routeMeta.desc),1)):(0,s.kq)("",!0)]),(0,s._)("div",c,[(0,s.Wm)(_,{class:"c-header__lang",selected:"icon",onChange:f.onLangChange,lang:f.lang},null,8,["onChange","lang"]),(0,s.Wm)(k,{trigger:"click"},{dropdown:(0,s.w5)((()=>[(0,s.Wm)($,null,{default:(0,s.w5)((()=>[(0,s.Wm)(v,{onClick:(0,o.iM)(f.logout,["stop"])},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(e.$t("account.common.logout")),1)])),_:1},8,["onClick"])])),_:1})])),default:(0,s.w5)((()=>[(0,s._)("div",m,[(0,s._)("span",h,(0,l.zw)(f.profile.username||f.profile.nickname),1)])])),_:1})])])])}var g=a(9158),f=a(2878),b={name:"PageHeader",data:function(){return{}},computed:{routeMeta(){return this.$route.meta},profile(){return this.$store.state.user},avatar(){var e;return(null===(e=this.profile)||void 0===e?void 0:e.avatar)&&"null"!=this.profile.avatar||a(9743)},app(){return this.$store.state.app},lang(){return g.Z.getLocale()}},watch:{},methods:{logout(){(0,f.kS)().then((()=>{g.Z.logout(),this.$router.push({name:"email-login"})}))},onLangChange(e){(0,f.gS)({lang:e},{app:this.app}).then((()=>{location.reload()}))}}},w=a(3744);const _=(0,w.Z)(b,[["render",p]]);var v=_},2375:function(e,t,a){a.r(t),a.d(t,{default:function(){return P}});var s=a(6252),l=a(3577),o=a(9963);const i={class:"p-setting-address"},d={class:"l-dashboard-primary"},n={class:"m-common-table w-card"},r={class:"m-table-filter"},u={class:"u-op"},c={class:"u-row"},m={key:1},h={class:"u-op"};function p(e,t,a,p,g,f){const b=(0,s.up)("page-header"),w=(0,s.up)("Plus"),_=(0,s.up)("el-icon"),v=(0,s.up)("el-tooltip"),$=(0,s.up)("Refresh"),k=(0,s.up)("StarFilled"),C=(0,s.up)("Star"),W=(0,s.up)("el-tag"),y=(0,s.up)("el-table-column"),V=(0,s.up)("el-button"),D=(0,s.up)("el-table"),x=(0,s.up)("addressForm"),T=(0,s.Q2)("loading");return(0,s.wg)(),(0,s.iD)("div",i,[(0,s.Wm)(b),(0,s._)("div",d,[(0,s._)("div",n,[(0,s._)("div",r,[(0,s._)("div",u,[(0,s.Wm)(v,{class:"u-box-item",effect:"light",content:e.$t("common.table.add"),placement:"top"},{default:(0,s.w5)((()=>[(0,s._)("div",{class:"u-op-icon u-refresh",onClick:t[0]||(t[0]=(...e)=>f.onAdd&&f.onAdd(...e))},[(0,s.Wm)(_,null,{default:(0,s.w5)((()=>[(0,s.Wm)(w)])),_:1})])])),_:1},8,["content"]),(0,s.Wm)(v,{class:"u-box-item",effect:"light",content:e.$t("common.table.refresh"),placement:"top"},{default:(0,s.w5)((()=>[(0,s._)("div",{class:"u-op-icon u-refresh",onClick:t[1]||(t[1]=(...e)=>f.load&&f.load(...e))},[(0,s.Wm)(_,null,{default:(0,s.w5)((()=>[(0,s.Wm)($)])),_:1})])])),_:1},8,["content"])])]),(0,s.wy)(((0,s.wg)(),(0,s.j4)(D,{class:"m-table",data:g.tableData,"max-height":"600px",size:"large"},{default:(0,s.w5)((()=>[(0,s.Wm)(y,{label:e.$t("setting.address.tag"),width:"180"},{default:(0,s.w5)((({row:t})=>[(0,s._)("div",c,[(0,s.Wm)(v,{class:"u-box-item",effect:"light",content:t.is_default?e.$t("setting.address.cancelDefault"):e.$t("setting.address.setDefault"),placement:"left"},{default:(0,s.w5)((()=>[(0,s.Wm)(W,{class:"u-default",type:t.is_default?"danger":"info",onClick:e=>f.onToggleDefault(t)},{default:(0,s.w5)((()=>[t.is_default?((0,s.wg)(),(0,s.j4)(_,{key:0,size:"18"},{default:(0,s.w5)((()=>[(0,s.Wm)(k)])),_:1})):((0,s.wg)(),(0,s.j4)(_,{key:1,size:"18"},{default:(0,s.w5)((()=>[(0,s.Wm)(C)])),_:1})),(0,s.Uk)(" "+(0,l.zw)(e.$t("setting.address.defaultTag")),1)])),_:2},1032,["type","onClick"])])),_:2},1032,["content"]),t.tag?((0,s.wg)(),(0,s.j4)(W,{key:0},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(t.tag),1)])),_:2},1024)):((0,s.wg)(),(0,s.iD)("span",m,"-"))])])),_:1},8,["label"]),(0,s.Wm)(y,{label:e.$t("setting.address.name"),prop:"name","show-overflow-tooltip":"",width:"180"},null,8,["label"]),(0,s.Wm)(y,{label:e.$t("setting.address.phone"),prop:"phone","show-overflow-tooltip":"",width:"180"},null,8,["label"]),(0,s.Wm)(y,{label:e.$t("setting.address.addr"),prop:"addr","show-overflow-tooltip":""},null,8,["label"]),(0,s.Wm)(y,{label:e.$t("common.table.op"),width:"180",align:"right"},{default:(0,s.w5)((({row:t})=>[(0,s._)("div",h,[(0,s.Wm)(v,{class:"u-box-item",effect:"light",content:e.$t("common.table.edit"),placement:"top"},{default:(0,s.w5)((()=>[(0,s.Wm)(V,{class:"u-edit",circle:"",plain:"",icon:"Edit",onClick:(0,o.iM)((e=>f.onEdit(t)),["stop"])},null,8,["onClick"])])),_:2},1032,["content"]),(0,s.Wm)(v,{class:"u-box-item",effect:"light",content:e.$t("common.table.remove"),placement:"top"},{default:(0,s.w5)((()=>[(0,s.Wm)(V,{class:"u-view",circle:"",plain:"",icon:"Delete",onClick:(0,o.iM)((e=>f.onDelete(t)),["stop"])},null,8,["onClick"])])),_:2},1032,["content"])])])),_:1},8,["label"])])),_:1},8,["data"])),[[T,g.loading]])])]),g.visible?((0,s.wg)(),(0,s.j4)(x,{key:0,visible:g.visible,"onUpdate:visible":t[2]||(t[2]=e=>g.visible=e),data:{mode:g.mode,staged:g.staged},onUpdate:f.load},null,8,["visible","data","onUpdate"])):(0,s.kq)("",!0)])}var g=a(6102);function f(e){return(0,g.VM)().post("/api/uc/user/i/address",e)}function b(e){return(0,g.VM)().get("/api/uc/user/i/address",{params:e})}function w(e,t){return(0,g.VM)().put(`/api/uc/user/i/address/${e}`,t)}function _(e){return(0,g.VM)().delete(`/api/uc/user/i/address/${e}`)}function v(e,t){return(0,g.VM)().put(`/api/uc/user/i/address/${e}/default`,t)}var $=a(6430);const k={class:"m-line"},C={class:"m-line"},W={class:"m-line"},y={class:"w-dialog__footer"};function V(e,t,a,o,i,d){const n=(0,s.up)("el-input"),r=(0,s.up)("el-form-item"),u=(0,s.up)("phone-code-select"),c=(0,s.up)("el-tag"),m=(0,s.up)("el-checkbox"),h=(0,s.up)("el-form"),p=(0,s.up)("el-button"),g=(0,s.up)("el-dialog");return(0,s.wg)(),(0,s.j4)(g,{class:"w-dialog","model-value":a.visible,title:d.title,"before-close":d.close,draggable:""},{footer:(0,s.w5)((()=>[(0,s._)("span",y,[(0,s.Wm)(p,{onClick:d.close},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(e.$t("common.messagebox.cancel")),1)])),_:1},8,["onClick"]),(0,s.Wm)(p,{type:"primary",loading:i.loading,disabled:i.loading,onClick:d.submit},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(e.$t("common.messagebox.confirm")),1)])),_:1},8,["loading","disabled","onClick"])])])),default:(0,s.w5)((()=>[(0,s.Wm)(h,{class:"m-address-form",ref:"form",model:i.form,rules:i.rules,"label-position":"top"},{default:(0,s.w5)((()=>[(0,s.Wm)(r,{prop:"name",label:e.$t("setting.address.name"),required:""},{default:(0,s.w5)((()=>[(0,s.Wm)(n,{modelValue:i.form.name,"onUpdate:modelValue":t[0]||(t[0]=e=>i.form.name=e),placeholder:e.$t("setting.address.namePlaceholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),(0,s.Wm)(r,{prop:"phone",label:e.$t("setting.address.phone"),required:""},{default:(0,s.w5)((()=>[(0,s._)("div",k,[(0,s.Wm)(u,{ref:"phoneCodeSelect",modelValue:i.phoneCode,"onUpdate:modelValue":t[1]||(t[1]=e=>i.phoneCode=e)},null,8,["modelValue"]),(0,s.Wm)(n,{modelValue:i.form.phone,"onUpdate:modelValue":t[2]||(t[2]=e=>i.form.phone=e),placeholder:e.$t("setting.address.phonePlaceholder")},null,8,["modelValue","placeholder"])])])),_:1},8,["label"]),(0,s.Wm)(r,{label:e.$t("setting.address.addr"),prop:"addr",required:""},{default:(0,s.w5)((()=>[(0,s._)("div",C,[(0,s.Wm)(n,{class:"u-detail-address",placeholder:e.$t("setting.address.addrPlaceholder"),modelValue:i.form.addr,"onUpdate:modelValue":t[3]||(t[3]=e=>i.form.addr=e)},null,8,["placeholder","modelValue"])])])),_:1},8,["label"]),(0,s.Wm)(r,{label:e.$t("setting.address.tag"),prop:"tag"},{default:(0,s.w5)((()=>[(0,s._)("div",W,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(i.tags,((e,t)=>((0,s.wg)(),(0,s.j4)(c,{key:t,class:"u-tag",type:d.getTagType(e),onClick:t=>d.onTag(e)},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(e),1)])),_:2},1032,["type","onClick"])))),128))]),i.isCustomTag?((0,s.wg)(),(0,s.j4)(n,{key:0,class:"u-custom-tag",placeholder:e.$t("setting.address.custom"),modelValue:i.form.tag,"onUpdate:modelValue":t[4]||(t[4]=e=>i.form.tag=e)},null,8,["placeholder","modelValue"])):(0,s.kq)("",!0)])),_:1},8,["label"]),(0,s.Wm)(r,{prop:"is_default"},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{modelValue:i.form.is_default,"onUpdate:modelValue":t[5]||(t[5]=e=>i.form.is_default=e)},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(this.$t("setting.address.isDefault")),1)])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["model-value","title","before-close"])}var D=a(6486),x=a(9709);const T={name:"",addr:"",phone:"",is_default:0,tag:""};var U={name:"AddressForm",emits:["update:visible","update"],props:["visible","data"],data(){return{loading:!1,phoneCode:86,form:{},rules:{name:[{required:!0,message:this.$t("setting.address.namePlaceholder"),trigger:"blur"}],addr:[{required:!0,message:this.$t("setting.address.addrPlaceholder"),trigger:"blur"}],phone:[{required:!0,message:this.$t("setting.address.phonePlaceholder"),trigger:"blur"},{validator:(e,t,a)=>{const s=`+${this.phoneCode}${t}`,l=(0,x.S)(s);l&&null!==l&&void 0!==l&&l.isValid()?a():a(new Error(this.$t("notification.phone.numberError")))},trigger:"blur"}]},tags:[this.$t("setting.address.school"),this.$t("setting.address.home"),this.$t("setting.address.company"),this.$t("setting.address.custom")],isCustomTag:!1}},computed:{isEdit(){return"edit"===this.data.mode},title(){return this.isEdit?this.$t("setting.address.edit"):this.$t("setting.address.add")}},watch:{data:{immediate:!0,handler({mode:e,staged:t}){if(this.form={...(0,D.cloneDeep)(T),...t},!this.form.tag||this.tags.includes(this.form.tag)&&this.form.tag!==this.tags[3]||(this.isCustomTag=!0),this.form.is_default=!!this.form.is_default,"edit"===e&&this.form.phone){const e=(0,x.S)(this.form.phone);this.phoneCode=~~(null===e||void 0===e?void 0:e.countryCallingCode)||86,this.form.phone=(null===e||void 0===e?void 0:e.nationalNumber)||""}}}},methods:{close(){this.$refs.form.resetFields(),this.$emit("update:visible",!1)},getTagType(e){let t="info";return t=this.form.tag&&e===this.form.tag||e===this.tags[3]&&this.isCustomTag?"primary":"info",t},onTag(e){this.form.tag=e,e!==this.tags[3]?this.isCustomTag=!1:(this.form.tag="",this.isCustomTag=!0)},add(){const e=(0,D.cloneDeep)((0,D.pick)(this.form,Object.keys(T)));e.is_default=~~e.is_default,e.phone=`+${this.phoneCode}${e.phone}`,this.loading=!0,f(e).then((e=>{this.$message({type:"success",message:this.$t("common.messagebox.success")});const t=e.data.data;this.$emit("update",t),this.close()})).finally((()=>{this.loading=!1}))},edit(){const e=(0,D.cloneDeep)((0,D.pick)(this.form,Object.keys(T)));e.is_default=~~e.is_default,e.phone=`+${this.phoneCode}${e.phone}`,this.loading=!0,w(this.data.staged.id,e).then((()=>{this.$message({type:"success",message:this.$t("common.messagebox.success")}),this.$emit("update",{...this.data.staged,...e}),this.close()})).finally((()=>{this.loading=!1}))},submit(){this.loading||this.$refs.form.validate(((e,t)=>{e?this.isEdit?this.edit():this.add():console.log("error submit!!!",t)}))}}},z=a(3744);const M=(0,z.Z)(U,[["render",V]]);var j=M,q={name:"dashboard-profile-address",components:{pageHeader:$.Z,addressForm:j},data(){return{loading:!1,tableData:[],visible:!1,mode:"add",staged:{}}},mounted(){this.load()},methods:{onToggleDefault({id:e,is_default:t}){this.loading=!0,v(e,{is_default:~~!t}).then((()=>{this.$notify({title:this.$t("common.messagebox.success"),type:"success",duration:2e3}),this.load()})).finally((()=>{this.loading=!1}))},load(){this.loading=!0,b().then((e=>{this.tableData=e.data.data||[]})).finally((()=>{this.loading=!1}))},onAdd(){this.staged={},this.mode="add",this.visible=!0},onEdit(e){this.staged=e,this.mode="edit",this.visible=!0},onDelete({id:e}){e&&this.$confirm(this.$t("common.table.removeAlert"),this.$t("common.messagebox.title"),{confirmButtonText:this.$t("common.messagebox.confirm"),cancelButtonText:this.$t("common.messagebox.cancel"),type:"warning"}).then((()=>{this.loading=!0,_(e).then((()=>{this.$notify({title:this.$t("common.messagebox.success"),type:"success",duration:2e3});const t=this.tableData.findIndex((t=>t.id===e));this.tableData.splice(t,1)})).finally((()=>{this.loading=!1}))})).catch((()=>{}))}}};const E=(0,z.Z)(q,[["render",p]]);var P=E},9743:function(e,t,a){e.exports=a.p+"img/test.2ffd992c.png"}}]);
//# sourceMappingURL=375.87dfa2bf.js.map